<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Reverie Writer</title>

<link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;500;600&family=Merriweather:ital,wght@0,400;0,700;1,400&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg-dark:#1e1e1e;
    --paper:#fafafa;
    --paper-2:#f5f5f5;
    --text-dark:#3a3a3a;
    --muted:#aaa;
    --controls:#eee;
    --accent:#ffbb66;
    --editor-width:70%;
    --editor-max:600px;
  }
  [data-theme="light"]{
    --bg-dark:#f3efe9;
    --paper:#fffef8;
    --paper-2:#fff9f0;
    --text-dark:#222;
    --muted:#666;
    --controls:#222;
    --accent:#d28f3a;
  }
  html,body{ height:100%; margin:0; }
  body{
    background:var(--bg-dark);
    font-family: monospace;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    position:relative;
  }
  .wrap { width:100%; display:flex; flex-direction:column; align-items:center; gap:0.5rem; }
  #sessionTitle{
    width:500px; max-width:90%;
    font-size:1.5rem; font-weight:500;
    margin:0; padding:0.25rem 0.5rem;
    color:var(--muted); background:transparent; border:none; outline:none;
    font-family: var(--app-font, 'Spectral'), serif; text-align:center;
  }
  #sessionTitle:empty:before{
    content:attr(data-placeholder); color:#bdbdbd; pointer-events:none;
  }
  #editor{
    width:var(--editor-width); max-width:var(--editor-max); height:6em;
    background: linear-gradient(to bottom, var(--paper) 0%, var(--paper-2) 100%);
    color:var(--text-dark); border:1px solid rgba(0,0,0,0.06);
    padding:2rem; resize:none; font-size:1.2rem; line-height:2.4em; outline:none;
    overflow:hidden; caret-color:var(--accent); border-radius:12px;
    font-family: var(--app-font, 'Spectral'), serif;
    box-shadow:0 10px 30px rgba(0,0,0,0.25), inset 0 5px 15px rgba(0,0,0,0.04);
    letter-spacing:0.5px; word-spacing:2px;
  }
  #controls{
    position:fixed; top:15px; right:15px; display:flex; gap:10px; align-items:center;
    opacity:0.95; z-index:50; font-family: var(--app-font, 'Spectral'), serif;
  }
  .small { font-size:0.85rem; color:var(--muted); user-select:none; }
  .icon-btn { background:none; border:none; color:var(--controls); font-size:1.2rem; cursor:pointer; padding:6px; }
  .icon-btn:focus { outline:2px solid rgba(255,187,102,0.12); border-radius:6px; }

  .settings { position:relative; }
  .settings-panel {
    position:absolute; right:0; top:36px;
    background:var(--bg-dark); color:var(--controls);
    border:1px solid rgba(255,255,255,0.03); padding:12px; width:240px;
    box-shadow:0 6px 18px rgba(0,0,0,0.4); display:none; z-index:60;
    font-family:var(--app-font,'Spectral'), serif;
  }
  .settings-panel.open{ display:block; }
  .settings-row{ margin-bottom:10px; display:flex; flex-direction:column; gap:6px; }
  select,input[type="checkbox"],input[type="number"]{ padding:6px; border-radius:6px; border:1px solid rgba(0,0,0,0.08); font-family:inherit; }
  label.small{ color:var(--muted); font-size:0.8rem; }

#resetThemeFontBtn {
  display:block;
  margin:10px auto 0 auto;
  padding:6px 14px;
  border-radius:8px;
  border:1.5px solid #b0b0b0;
  background:#e0e0e0;
  color:#111;
  font-family:var(--app-font, 'Spectral');
  font-weight:500;
  cursor:pointer;
  text-align:center;
  font-size:0.95rem;
}
  #resetThemeFontBtn:hover { opacity:0.85; }

  @media (max-width:640px){
    #editor{ width:90%; padding:1.2rem; }
    #sessionTitle{ width:calc(90% - 2rem); }
    .settings-panel{ right:6px; left:auto; }
  }
</style>
</head>
<body data-theme="dark">

<div id="controls">
  <div class="small" id="wordCount">Words: 0 | Chars: 0 (with spaces: 0)</div>
  <div class="small" id="timer">Time: 0s</div>

  <button id="fullscreenBtn" class="icon-btn" title="Toggle Fullscreen">‚õ∂</button>
  <button id="pauseBtn" class="icon-btn" title="Pause/Resume Session">‚è∏Ô∏è</button>
  <button id="resetBtnTop" class="icon-btn" title="Reset Session">üîÑ</button>

  <div class="settings">
    <button id="settingsBtn" class="icon-btn" title="Settings">‚öôÔ∏è</button>
    <div id="settingsPanel" class="settings-panel" role="dialog" aria-hidden="true">
      <div class="settings-row">
        <label class="small">Font</label>
        <select id="fontSelect">
          <option value="Spectral">Spectral (serif)</option>
          <option value="Merriweather">Merriweather (serif)</option>
          <option value="Inter">Inter (sans)</option>
          <option value="monospace">Monospace</option>
          <option value="Georgia">Georgia</option>
        </select>
      </div>
      <div class="settings-row">
        <label class="small">Theme</label>
        <select id="themeSelect">
          <option value="dark">Dark</option>
          <option value="light">Light</option>
        </select>
      </div>
      <button id="resetThemeFontBtn">Reset</button>
    </div>
  </div>

  <button id="downloadBtn" class="icon-btn" title="Download & Pause">üíæ</button>
</div>

<div class="wrap">
  <div id="sessionTitle" contenteditable="true" data-placeholder="What are you writing about?"></div>
  <textarea id="editor" spellcheck="false" placeholder="Start writing..."></textarea>
</div>

<script>
/* ===== Elements ===== */
const editor=document.getElementById('editor');
const sessionTitle=document.getElementById('sessionTitle');
const wordCountEl=document.getElementById('wordCount');
const timerEl=document.getElementById('timer');
const fullscreenBtn=document.getElementById('fullscreenBtn');
const pauseBtn=document.getElementById('pauseBtn');
const resetBtnTop=document.getElementById('resetBtnTop');
const downloadBtn=document.getElementById('downloadBtn');
const settingsBtn=document.getElementById('settingsBtn');
const settingsPanel=document.getElementById('settingsPanel');
const fontSelect=document.getElementById('fontSelect');
const themeSelect=document.getElementById('themeSelect');
const resetThemeFontBtn=document.getElementById('resetThemeFontBtn');

/* ===== State ===== */
let isPaused=false;
let startTime=Date.now();
let elapsedBefore=0;
let timerInterval;

/* ===== Local Storage Keys ===== */
const LS_SESSION='reverie_writer_session';
const LS_SETTINGS='reverie_writer_settings';

/* ===== Font & Theme ===== */
function applyFont(name){
  let fam;
  switch(name){
    case 'Merriweather': fam="'Merriweather', serif"; break;
    case 'Inter': fam="'Inter', sans-serif"; break;
    case 'monospace': fam="monospace"; break;
    case 'Georgia': fam="Georgia, serif"; break;
    default: fam="'Spectral', serif";
  }
  document.documentElement.style.setProperty('--app-font', fam);
  fontSelect.value=name;
  saveSettings();
}
function applyTheme(name){
  document.body.setAttribute('data-theme', name==='light'?'light':'dark');
  themeSelect.value=name;
  saveSettings();
}

/* ===== Stats ===== */
function updateStats(){
  const text = editor.value;
  const words = text.trim().split(/\s+/).filter(Boolean).length;
  const charsWithSpaces = text.length;
  const charsNoSpaces = text.replace(/\s/g,'').length;

  wordCountEl.textContent = `Words: ${words} | Chars: ${charsNoSpaces} (with spaces: ${charsWithSpaces})`;
  return { words, charsWithSpaces, charsNoSpaces };
}

/* ===== Timer ===== */
function updateTimerDisplay(){
  let s=elapsedBefore;
  let display='';
  if(s<60) display=`${s}s`;
  else if(s<3600){ const m=Math.floor(s/60); const sec=s%60; display=`${m}m ${sec}s`; }
  else { const h=Math.floor(s/3600); const m=Math.floor((s%3600)/60); const sec=s%60; display=`${h}h ${m}m ${sec}s`; }
  timerEl.textContent='Time: '+display;
}
function startTimer(){
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    if(!isPaused){
      const now=Date.now();
      elapsedBefore += Math.floor((now-startTime)/1000);
      startTime=now;
      updateStats();
      updateTimerDisplay();
    }
  },1000);
}

/* ===== Pause / Resume ===== */
function applyPauseState(paused){
  if(!paused && isPaused){
    startTime=Date.now(); // resume from where left off
  }
  isPaused=paused;
  editor.readOnly=isPaused;
  sessionTitle.contentEditable=!isPaused;
  pauseBtn.textContent=isPaused?'‚ñ∂Ô∏è':'‚è∏Ô∏è';
}
pauseBtn.addEventListener('click', ()=> applyPauseState(!isPaused));

/* ===== Reset Session ===== */
resetBtnTop.addEventListener('click',()=>{
  editor.value=''; sessionTitle.textContent='';
  elapsedBefore=0; startTime=Date.now();
  applyPauseState(false);
  updateStats(); updateTimerDisplay();
  localStorage.removeItem(LS_SESSION);
});

/* ===== Fullscreen ===== */
fullscreenBtn.addEventListener('click',()=>{
  if(!document.fullscreenElement) document.documentElement.requestFullscreen();
  else document.exitFullscreen();
});

/* ===== Download ===== */
downloadBtn.addEventListener('click',()=>{
  const text=editor.value;
  const title=sessionTitle.textContent.trim();
  const stats = updateStats();
  const elapsed = elapsedBefore;

  let display='';
  if(elapsed<60) display=`${elapsed}s`;
  else if(elapsed<3600){ const m=Math.floor(elapsed/60); const sec=elapsed%60; display=`${m}m ${sec}s`; }
  else { const h=Math.floor(elapsed/3600); const m=Math.floor((elapsed%3600)/60); const sec=elapsed%60; display=`${h}h ${m}m ${sec}s`; }

  const header=`Title: ${title||'[No Title]'}
Words: ${stats.words}
Characters (no spaces): ${stats.charsNoSpaces}
Characters (with spaces): ${stats.charsWithSpaces}
Time: ${display}

`;
  const blob=new Blob([header+text],{type:'text/plain'});
  const link=document.createElement('a');
  link.href=URL.createObjectURL(blob);
  const now=new Date();
  link.download=`reveriewriter_${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}-${String(now.getMinutes()).padStart(2,'0')}-${String(now.getSeconds()).padStart(2,'0')}.txt`;
  link.click();
  applyPauseState(true);
});

/* ===== Settings Panel ===== */
settingsBtn.addEventListener('click',(e)=>{
  e.stopPropagation();
  const open=settingsPanel.classList.toggle('open');
  settingsPanel.setAttribute('aria-hidden',!open);
});
document.addEventListener('click',(e)=>{
  if(!settingsPanel.contains(e.target) && e.target!==settingsBtn){
    settingsPanel.classList.remove('open');
    settingsPanel.setAttribute('aria-hidden','true');
  }
});
fontSelect.addEventListener('change',()=>applyFont(fontSelect.value));
themeSelect.addEventListener('change',()=>applyTheme(themeSelect.value));
resetThemeFontBtn.addEventListener('click',()=>{
  applyFont('Spectral'); applyTheme('dark');
  localStorage.removeItem(LS_SETTINGS);
});

/* ===== Local Storage Functions ===== */
function saveSession(){
  const stats = updateStats();
  const sessionData={
    title: sessionTitle.textContent,
    content: editor.value,
    words: stats.words,
    charsWithSpaces: stats.charsWithSpaces,
    charsNoSpaces: stats.charsNoSpaces,
    elapsed: elapsedBefore
  };
  localStorage.setItem(LS_SESSION, JSON.stringify(sessionData));
}
function restoreSession(){
  const data=localStorage.getItem(LS_SESSION);
  if(data){
    const s=JSON.parse(data);
    sessionTitle.textContent=s.title || '';
    editor.value=s.content || '';
    elapsedBefore=s.elapsed || 0;
    updateStats();
    updateTimerDisplay();
  }
}
function saveSettings(){
  const sData={ font: fontSelect.value, theme: themeSelect.value };
  localStorage.setItem(LS_SETTINGS, JSON.stringify(sData));
}
function restoreSettings(){
  const data=localStorage.getItem(LS_SETTINGS);
  if(data){
    const s=JSON.parse(data);
    applyFont(s.font||'Spectral');
    applyTheme(s.theme||'dark');
  } else {
    applyFont('Spectral');
    applyTheme('dark');
  }
}

/* ===== Auto-save Interval ===== */
setInterval(()=>{
  if(!isPaused) saveSession();
},5000);

/* ===== Restore on Load ===== */
restoreSettings();
restoreSession();
startTimer();
</script>
</body>
</html>
